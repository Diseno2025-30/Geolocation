name: Deploy Feature Branch to Test

on:
  push:
    branches:
      - Oliver-branch
      - Hernando-branch
      - Alan-branch
      - Sebastian-branch
  workflow_dispatch:
    inputs:
      branch:
        description: "Feature branch to deploy"
        required: true
        type: choice
        options:
          - Oliver-branch
          - Hernando-branch
          - Alan-branch
          - Sebastian-branch

jobs:
  # Job separado para Oliver
  deploy-oliver:
    if: (github.event_name == 'push' && github.ref_name == 'Oliver-branch') || (github.event_name == 'workflow_dispatch' && github.event.inputs.branch == 'Oliver-branch')
    runs-on: [self-hosted, EC2, Oliver]
    steps:
      - name: Deploy Oliver's branch
        run: |
          echo "ðŸš€ Desplegando Oliver-branch"
          BRANCH_NAME="Oliver-branch"
          PERSON_NAME="Oliver"
          INSTANCE_NUM="1"

          # Incluir el script de despliegue comÃºn
          source <(curl -s https://raw.githubusercontent.com/Diseno2025-30/Geolocation/main/.github/scripts/deploy-common.sh) || true

      - name: Checkout branch
        uses: actions/checkout@v3
        with:
          ref: Oliver-branch

      - name: Execute deployment
        env:
          ENV_FILE: ${{ secrets.ENV_FILE_1 }}
          DOMAIN_BASE: tumaquinaya.com
        run: |
          bash .github/scripts/deploy-local.sh "oliver" "tumaquinaya.com" "1" "Oliver-branch" "Oliver" "$ENV_FILE"

  # Job separado para Hernando
  deploy-hernando:
    if: (github.event_name == 'push' && github.ref_name == 'Hernando-branch') || (github.event_name == 'workflow_dispatch' && github.event.inputs.branch == 'Hernando-branch')
    runs-on: [self-hosted, EC2, Hernando]
    steps:
      - name: Deploy Hernando's branch
        run: |
          echo "ðŸš€ Desplegando Hernando-branch"
          BRANCH_NAME="Hernando-branch"
          PERSON_NAME="Hernando"
          INSTANCE_NUM="2"

      - name: Checkout branch
        uses: actions/checkout@v3
        with:
          ref: Hernando-branch

      - name: Execute deployment
        env:
          ENV_FILE: ${{ secrets.ENV_FILE_2 }}
          DOMAIN_BASE: tumaquinaya.com
        run: |
          bash .github/scripts/deploy-local.sh "hernando" "tumaquinaya.com" "2" "Hernando-branch" "Hernando" "$ENV_FILE"

  # Job separado para Alan
  deploy-alan:
    if: (github.event_name == 'push' && github.ref_name == 'Alan-branch') || (github.event_name == 'workflow_dispatch' && github.event.inputs.branch == 'Alan-branch')
    runs-on: [self-hosted, EC2, Alan]
    steps:
      - name: Deploy Alan's branch
        run: |
          echo "ðŸš€ Desplegando Alan-branch"
          BRANCH_NAME="Alan-branch"
          PERSON_NAME="Alan"
          INSTANCE_NUM="3"

      - name: Checkout branch
        uses: actions/checkout@v3
        with:
          ref: Alan-branch

      - name: Execute deployment
        env:
          ENV_FILE: ${{ secrets.ENV_FILE_3 }}
          DOMAIN_BASE: tumaquinaya.com
        run: |
          bash .github/scripts/deploy-local.sh "alan" "tumaquinaya.com" "3" "Alan-branch" "Alan" "$ENV_FILE"

  # Job separado para Sebastian
  deploy-sebastian:
    if: (github.event_name == 'push' && github.ref_name == 'Sebastian-branch') || (github.event_name == 'workflow_dispatch' && github.event.inputs.branch == 'Sebastian-branch')
    runs-on: [self-hosted, EC2, Sebastian]
    steps:
      - name: Deploy Sebastian's branch
        run: |
          echo "ðŸš€ Desplegando Sebastian-branch"
          BRANCH_NAME="Sebastian-branch"
          PERSON_NAME="Sebastian"
          INSTANCE_NUM="4"

      - name: Checkout branch
        uses: actions/checkout@v3
        with:
          ref: Sebastian-branch

      - name: Execute deployment
        env:
          ENV_FILE: ${{ secrets.ENV_FILE_4 }}
          DOMAIN_BASE: tumaquinaya.com
        run: |
          bash .github/scripts/deploy-local.sh "sebastian" "tumaquinaya.com" "4" "Sebastian-branch" "Sebastian" "$ENV_FILE"
