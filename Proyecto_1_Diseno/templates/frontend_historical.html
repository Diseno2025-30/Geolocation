<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ name }} - Historical</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    
    <!-- Custom CSS - Rutas resueltas en el servidor -->
    <link rel="stylesheet" href="{{ get_static_path('css/base.css') }}">
    <link rel="stylesheet" href="{{ get_static_path('css/historical.css') }}">
    <link rel="stylesheet" href="{{ get_static_path('css/sidebar.css') }}">
    
    <!-- Variable global para JavaScript -->
    <script>
        window.BASE_PATH = "{{ get_base_path() }}";
    </script>
</head>
<body>
    <!-- Elementos ocultos para almacenar datos del sistema -->
    <div style="display: none;">
        <span id="lastQuery">Never</span>
        <span id="puntosHistoricos">0</span>
        <span id="rangoConsultado">---</span>
        <span id="diasIncluidos">---</span>
    </div>

    <!-- Sidebar lateral -->
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h3>Navegaci√≥n</h3>
            <button id="sidebarToggle" class="sidebar-toggle">‚óÄ</button>
        </div>
        
        <div class="sidebar-content">
            <!-- Navegaci√≥n entre vistas -->
            <div class="sidebar-section">
                <h4>Vistas</h4>
                <a id="realtimeLink" class="sidebar-link">
                    <span class="link-icon">üïê</span>
                    Real-Time
                </a>
                <button class="sidebar-link active">
                    <span class="link-icon">üìä</span>
                    Historical View
                </button>
            </div>
            
            <!-- Navegaci√≥n entre rastreadores -->
            <div id="navigationSidebar" class="sidebar-section">
                <h4>Rastreadores</h4>
            </div>
        </div>
    </div>

    <!-- Bot√≥n para abrir sidebar en m√≥vil -->
    <button id="sidebarOpenBtn" class="sidebar-open-btn">‚ò∞</button>

    <!-- Bot√≥n de informaci√≥n flotante -->
    <button id="infoBtn" class="info-btn" title="Informaci√≥n del Sistema">
        <span class="info-icon">i</span>
    </button>

    <!-- Modal de informaci√≥n -->
    <div id="infoModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" id="closeModal">&times;</button>
            <h3>Informaci√≥n del Sistema</h3>
            <div class="modal-body">
                <div class="modal-field">
                    <span class="modal-label">Modo:</span>
                    <span class="modal-value mode-value">HISTORICAL</span>
                </div>
                <div class="modal-field">
                    <span class="modal-label">√öltima consulta:</span>
                    <span id="modalLastQuery" class="modal-value">Never</span>
                </div>
                <div class="modal-field">
                    <span class="modal-label">Puntos mostrados:</span>
                    <span id="modalPuntos" class="modal-value">0</span>
                </div>
                <div class="modal-field">
                    <span class="modal-label">Rango consultado:</span>
                    <span id="modalRango" class="modal-value">---</span>
                </div>
                <div class="modal-field">
                    <span class="modal-label">D√≠as incluidos:</span>
                    <span id="modalDias" class="modal-value">---</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Contenedor principal -->
    <div id="mainContent" class="main-content">
        <div class="container">
            <h1>Rastreador versi√≥n estable 2.3 - {{ name }} - Hist√≥rico</h1>

            <!-- Historical query section -->
            <div class="historical-section">
                <h3>Consulta Hist√≥rica por Rango</h3>
                <div class="range-row">
                    <div class="range-group">
                        <label>Fecha inicio:</label>
                        <input type="date" id="fechaInicio" class="date-input">
                        <input type="time" id="horaInicio" class="time-input" value="00:00">
                    </div>
                </div>
                <div class="range-row">
                    <div class="range-group">
                        <label>Fecha fin:</label>
                        <input type="date" id="fechaFin" class="date-input">
                        <input type="time" id="horaFin" class="time-input" value="23:59">
                    </div>
                </div>
                <div class="range-row">
                    <button class="btn" onclick="verHistoricoRango()">Ver Historial</button>
                    <button class="btn" onclick="limpiarMapa()">Limpiar Mapa</button>
                    <button class="btn" onclick="establecerRangoHoy()">Hoy</button>
                    <button class="btn" onclick="establecerRangoUltimos7Dias()">√öltimos 7 d√≠as</button>
                </div>
            </div>

            <!-- Historical controls (hidden by default) -->
            <div class="historical-controls" id="historicalControls">
                <button class="btn" onclick="toggleMarcadores()">
                    <span id="toggleMarcadoresText">Ocultar Marcadores</span>
                </button>
                <button class="btn" onclick="ajustarVista()">Ajustar Vista</button>
                <button class="btn" onclick="exportarDatos()">Exportar Datos</button>
            </div>

            <!-- Map -->
            <h2>Mapa Hist√≥rico</h2>
            <div id="map"></div>

            <!-- Route information -->
            <div class="coordinates">
                <h2>Informaci√≥n del Recorrido</h2>
                <div class="field">
                    <span class="label">Punto inicial:</span>
                    <span id="puntoInicial" class="value">---.------</span>
                </div>
                <div class="field">
                    <span class="label">Punto final:</span>
                    <span id="puntoFinal" class="value">---.------</span>
                </div>
                <div class="field">
                    <span class="label">Distancia aprox:</span>
                    <span id="distanciaTotal" class="value">--- km</span>
                </div>
                <div class="field">
                    <span class="label">Duraci√≥n:</span>
                    <span id="duracion" class="value">---</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    
    <!-- Custom JS - Rutas resueltas en el servidor -->
    <!-- IMPORTANTE: navigation.js debe cargarse ANTES de sidebar.js -->
    <script src="{{ get_static_path('js/navigation.js') }}"></script>
    <script src="{{ get_static_path('js/sidebar.js') }}"></script>
    <script src="{{ get_static_path('js/historical.js') }}"></script>
</body>
</html>