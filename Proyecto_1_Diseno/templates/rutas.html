<!-- templates/rutas.html -->
{% extends "_base.html" %}

{% block title %}GestiÃ³n de Rutas{% endblock %}

{% block page_css %}
<link rel="stylesheet" href="{{ get_static_path('css/rutas.css') }}" />
{% endblock %}

{% block page_name %}GestiÃ³n de Rutas Preestablecidas{% endblock %}

{% block main_content %}
<div class="rutas-container">
  <!-- Panel Izquierdo: Lista de Rutas -->
  <div class="control-panel">
    <div class="panel-header">
      <h2>Rutas Existentes</h2>
    </div>
    
    <div class="panel-section">
      <h3>Filtrar por Empresa</h3>
      <select id="empresaSelector" class="form-input">
        <option value="">Todas las empresas</option>
      </select>
    </div>

    <div class="panel-section">
      <div id="rutasList" class="rutas-list">
        <p>Cargando rutas...</p>
      </div>
    </div>

    <div class="panel-section">
      <button id="btnCrearRuta" class="btn-primary">
        ï¼‹ Crear Nueva Ruta
      </button>
    </div>
  </div>

  <!-- Panel Central: Mapa -->
  <div class="map-section">
    <div id="map" class="map-container"></div>
    
    <!-- Info del mapa -->
    <div class="map-info-box">
      <div class="info-item">
        <span class="info-label">Ruta:</span>
        <span id="selectedRutaName" class="info-value">Ninguna</span>
      </div>
      <div class="info-item">
        <span class="info-label">Empresa:</span>
        <span id="selectedRutaEmpresa" class="info-value">---</span>
      </div>
      <div class="info-item">
        <span class="info-label">Segmentos:</span>
        <span id="selectedRutaSegments" class="info-value">0</span>
      </div>
    </div>
  </div>

  <!-- Panel Derecho: Editor de Ruta (oculto inicialmente) -->
  <div id="rutaEditorPanel" class="editor-panel" style="display: none;">
    <div class="editor-header">
      <h2 id="editorTitle">Crear Nueva Ruta</h2>
      <button class="btn-close" id="btnCerrarEditor">&times;</button>
    </div>
    
    <div class="editor-body">
      <!-- InformaciÃ³n de ayuda -->
      <div class="help-box">
        <h4>ğŸ“ SelecciÃ³n de Segmentos</h4>
        <p>Haz clic en el mapa para seleccionar segmentos de calle en orden.</p>
      </div>
      
      <!-- Formulario -->
      <form id="rutaForm">
        <div class="form-group">
          <label for="rutaNombre">Nombre de la Ruta *</label>
          <input type="text" id="rutaNombre" class="form-input" required placeholder="Ej: Ruta Principal Centro">
        </div>
        
        <div class="form-group">
          <label for="rutaEmpresa">Empresa *</label>
          <select id="rutaEmpresa" class="form-input" required>
            <option value="">Seleccione una empresa</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="rutaDescripcion">DescripciÃ³n</label>
          <textarea id="rutaDescripcion" class="form-input" rows="3" placeholder="DescripciÃ³n opcional"></textarea>
        </div>
      </form>
      
      <!-- Lista de segmentos -->
      <div class="segments-section">
        <h4>Segmentos Seleccionados (<span id="segmentCount">0</span>)</h4>
        
        <div id="selectedSegmentsList" class="selected-segments-list" style="display: none;">
          <!-- Los segmentos se agregarÃ¡n aquÃ­ dinÃ¡micamente -->
        </div>
        
        <p class="segments-placeholder" id="segmentsPlaceholder">
          Haz clic en el mapa para comenzar
        </p>
        
        <button type="button" id="btnLimpiarSegmentos" class="btn-clear" style="display: none;">
          ğŸ—‘ï¸ Limpiar Segmentos
        </button>
      </div>
      
      <!-- Botones de acciÃ³n -->
      <div class="editor-actions">
        <button type="button" class="btn-secondary" id="btnCancelar">Cancelar</button>
        <button type="button" class="btn-primary" id="btnGuardar">Guardar Ruta</button>
      </div>
    </div>
  </div>
</div>

<!-- Debugging visual -->
<div id="debugInfo" style="position: fixed; top: 10px; left: 10px; background: rgba(0,0,0,0.8); color: #0f0; padding: 10px; border-radius: 5px; z-index: 99999; font-family: monospace; font-size: 12px;">
  <div>Modo: <span id="debugMode">Ver</span></div>
  <div>Segmentos: <span id="debugSegments">0</span></div>
</div>
{% endblock %}

{% block page_js %}
<script type="module" src="{{ get_static_path('js/rutas.js') }}"></script>
{% endblock %}