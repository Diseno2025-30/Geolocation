<!-- templates/rutas.html -->
{% extends "_base.html" %}

{% block title %}Gestión de Rutas{% endblock %}

{% block page_css %}
<!-- Reemplaza el CSS complejo con el simple -->
<link rel="stylesheet" href="{{ get_static_path('css/rutas-simple.css') }}" />
{% endblock %}

{% block page_name %}Gestión de Rutas Preestablecidas{% endblock %}

{% block main_content %}
<div class="rutas-container">
  <!-- Panel de Control -->
  <div class="control-panel">
    <div class="panel-header">
      <h2>Panel de Control</h2>
    </div>
    
    <div class="panel-section">
      <h3>Filtrar por Empresa</h3>
      <select id="empresaSelector" class="form-input">
        <option value="">Todas las empresas</option>
      </select>
    </div>

    <div class="panel-section">
      <h3>Rutas Disponibles</h3>
      <div id="rutasList" class="rutas-list">
        <p>Cargando rutas...</p>
      </div>
    </div>

    <div class="panel-section">
      <button id="btnCrearRuta" class="btn-primary">
        ＋ Crear Nueva Ruta
      </button>
    </div>
  </div>

  <!-- Mapa -->
  <div class="map-section">
    <div id="map" class="map-container"></div>
  </div>
</div>

<!-- Modal para Crear/Editar Ruta -->
<div id="rutaModal" class="modal" style="display: none;">
  <div class="modal-content">
    <button class="modal-close" id="closeRutaModal">&times;</button>
    <h3 id="modalTitle">Crear Nueva Ruta</h3>
    
    <div id="segmentSelectionInfo" class="segment-selection-info">
      <h4>Selección de Segmentos</h4>
      <p>Haz clic en el mapa para seleccionar segmentos de calle.</p>
      <p>Cada segmento aparecerá en el mapa con un número.</p>
    </div>
    
    <form id="rutaForm">
      <div class="form-group">
        <label for="rutaNombre">Nombre de la Ruta *</label>
        <input type="text" id="rutaNombre" class="form-input" required placeholder="Ej: Ruta Principal">
      </div>
      
      <div class="form-group">
        <label for="rutaEmpresa">Empresa *</label>
        <select id="rutaEmpresa" class="form-input" required>
          <option value="">Seleccione una empresa</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="rutaDescripcion">Descripción</label>
        <textarea id="rutaDescripcion" class="form-input" rows="3" placeholder="Descripción opcional"></textarea>
      </div>
      
      <div class="form-group">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
          <label>Segmentos de Calle</label>
          <button type="button" id="btnLimpiarSegmentos" class="btn-secondary" style="padding: 6px 12px; font-size: 12px;">
            Limpiar
          </button>
        </div>
        <div class="segments-container">
          <p class="segments-placeholder" id="segmentsPlaceholder">
            Haga clic en el mapa para seleccionar segmentos
          </p>
          <div id="selectedSegmentsList" class="selected-segments-list" style="display: none;"></div>
        </div>
        <div style="text-align: right; margin-top: 8px; font-size: 14px;">
          <span id="segmentCount">0</span> segmentos seleccionados
        </div>
      </div>
      
      <div class="form-actions" style="display: flex; gap: 10px; margin-top: 20px;">
        <button type="button" class="btn-secondary" id="cancelRutaBtn">Cancelar</button>
        <button type="submit" class="btn-primary" id="saveRutaBtn">Guardar Ruta</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block page_js %}
<script type="module" src="{{ get_static_path('js/rutas.js') }}"></script>
{% endblock %}