<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Mapas OSRM</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <!-- Editor CSS -->
    <link rel="stylesheet" href="{{ get_static_path('css/mapa_editor/mapa_editor.css') }}" />

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            overflow: hidden;
        }

        #map {
            width: 100vw;
            height: 100vh;
        }
    </style>

    <script>
        window.BASE_PATH = "{{ get_base_path() }}";
    </script>
</head>
<body>
    <!-- Contenedor del mapa -->
    <div id="map"></div>

    <!-- Toolbar del editor -->
    <div class="editor-toolbar">
        <h3>ğŸ—ºï¸ Editor de Mapas</h3>

        <!-- Modos de ediciÃ³n -->
        <div class="btn-group">
            <button class="editor-btn active" data-mode="VIEW" onclick="mapaEditor.setMode('VIEW')">
                ğŸ‘ï¸ Ver
            </button>
            <button class="editor-btn" data-mode="DRAW" onclick="mapaEditor.startDrawing()">
                âœï¸ Dibujar Calle
            </button>
            <button class="editor-btn" data-mode="DELETE" onclick="mapaEditor.setMode('DELETE')">
                ğŸ—‘ï¸ Eliminar
            </button>
        </div>

        <!-- Acciones -->
        <div class="btn-group">
            <button class="editor-btn" onclick="mapaEditor.loadExistingWays()">
                ğŸ”„ Recargar
            </button>
            <button class="editor-btn action" onclick="mapaEditor.exportToGeoJSON()">
                ğŸ“¥ GeoJSON
            </button>
            <button class="editor-btn action" onclick="mapaEditor.exportToOSM()">
                ğŸ“¤ Exportar OSM
            </button>
            <button class="editor-btn danger" onclick="mapaEditor.updateOSRM()">
                ğŸ³ Actualizar OSRM
            </button>
        </div>
    </div>

    <!-- NotificaciÃ³n -->
    <div id="editor-notification" class="editor-notification"></div>

    <!-- Panel de informaciÃ³n -->
    <div class="editor-info-panel">
        <h4>ğŸ“Š EstadÃ­sticas</h4>
        <div class="info-item">
            <span>Calles:</span>
            <strong id="stats-ways">-</strong>
        </div>
        <div class="info-item">
            <span>Nodos:</span>
            <strong id="stats-nodes">-</strong>
        </div>
        <div class="info-item">
            <span>Modo:</span>
            <strong id="stats-mode">Ver</strong>
        </div>
    </div>

    <!-- Panel de ayuda -->
    <div class="editor-help">
        <h5>âŒ¨ï¸ Atajos de teclado</h5>
        <ul>
            <li><kbd>Esc</kbd> - Cancelar operaciÃ³n</li>
            <li><kbd>Enter</kbd> - Finalizar dibujo</li>
            <li><kbd>Backspace</kbd> - Eliminar Ãºltimo punto</li>
        </ul>
    </div>

    <!-- Loading overlay -->
    <div id="editor-loading" class="editor-loading">
        <div class="spinner"></div>
        <p>Procesando...</p>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <!-- Editor JS -->
    <script src="{{ get_static_path('js/mapa_editor/mapa_editor.js') }}"></script>

    <!-- Script de actualizaciÃ³n de estadÃ­sticas -->
    <script>
        // Actualizar estadÃ­sticas cada 2 segundos
        setInterval(async () => {
            try {
                const basePath = window.BASE_PATH || '';
                const response = await fetch(`${basePath}/api/mapa/stats`);

                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.stats) {
                        document.getElementById('stats-ways').textContent = data.stats.total_ways || 0;
                        document.getElementById('stats-nodes').textContent = data.stats.total_nodes || 0;
                    }
                }
            } catch (error) {
                console.error('Error actualizando estadÃ­sticas:', error);
            }
        }, 2000);
    </script>
</body>
</html>
